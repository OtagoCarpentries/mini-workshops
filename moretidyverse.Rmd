---
title: "More Tidyverse"
description: |
  Take the time to explore the lesser known functions and packages of the Tidyverse
author:
  - name: Murray Cadzow
    url: 
    affiliation: University of Otago
    affiliation_url:
  - name: Matt Bixley
    url: 
    affiliation: NeSI
    affiliation_url:
date: "2021-07-05"
output: 
  distill::distill_article:
    toc: yes
    css: style.css
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

Time: 90 min

Description: Take the time to explore the lesser known functions and packages of the Tidyverse. Learn about how to access googlesheets, use times/dates, manipulate text, use functional programming to replace loops, and more.

Learning objectives

- What packages are in the tidyverse
- Understand functional programming







> The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures. 
> -  https://www.tidyverse.org


https://rstudio-education.github.io/tidyverse-cookbook/index.html

## Core Tidyverse

```{r, message = TRUE}
library(tidyverse)
```



### [tibble](https://tibble.tidyverse.org)

```{r, echo = FALSE}
knitr::include_graphics("images/tibble.png")
```


`tibble::tribble` is a useful function if you want to manually input a small amount of data.

```{r, echo = TRUE}
tibble::tribble( ~column1, ~column2, ~column3,
                 "a", 1, TRUE,
                 "b", 2, FALSE)
```



`tibble::glimpse` is similar to `str` but can be embedded in pipelines as it invisibly returns the original data.

```{r}
tibble::glimpse(mtcars)
```

<div class='exercise'>
#### Exercise

Use `tribble()` to manually input some data 
</div>


### [ggplot2](https://ggplot2.tidyverse.org)

```{r, echo = FALSE}
knitr::include_graphics("images/ggplot2.png")
```

The majority of `ggplot2` functions are specific to the type of visualisation that is being created and well covered by the cheatsheet. There is one however that can be very helpful to know about.


`ggplot2::theme_set` allows you to apply a theme to all of your ggplots. It would usually be called near the start of a script.


```{r}
# Set the theme to theme_bw for all following plots
ggplot2::theme_set(theme_bw())
```


### [dplyr](https://dplyr.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/dplyr.png")
```
 
 `dplyr::rename` provides the renaming ability of `dplyr::select` but it doesn't subset.
 
`dplyr::transmute` is similar to `dplyr::mutate` except only columns specified are kept.

`dplyr::starts_with`/`dplyr::contains`/`dplyr::ends_with` are useful helper functions to enable easy selection of columns.

`dplyr::relocate` is a very useful function that enables you to relocate columns to specific locations. It uses a `.before` or `.after` argument to specify where you to more the column(s) to.

`dplyr::across` lets you apply a function or functions across multiple columns. This is usually used in conjunction with `dplyr::summarise` or `dplyr::mutate`.

`dplyr::c_across` lets you combine values from across multiple columns, such as performing a summarising function on select columns.

`dplyr::case_when` is useful in situations where you would have multiple ifelses.

<div class='exercise'>
#### Exercise


</div>



### [tidyr](https://tidyr.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/tidyr.png")
```

- `tidyr::nest`
- `tidyr::unnest`
- `tidyr::separate`/`tidyr::separate_rows`
- `tidyr::unite`
- `tidyr::crossing`
- `tidyr::drop_na`
- `tidyr::replace_na`


<div class='exercise'>
#### Exercise


</div>

### [forcats](https://forcats.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/forcats.png")
```

- `forcats::relevel`
- `forcats::reorder`
- `forcats::recode`


<div class='exercise'>
#### Exercise

Use `forcats` to re-order your bar plot so that it is most frequent on the left, and least on the right.

</div>

### [stringr](https://stringr.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/stringr.png")
```

- `stringr::str_detect`
- `stringr::str_remove`
- `stringr::str_extract`

<div class='exercise'>
#### Exercise


</div>

### [readr](https://readr.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/readr.png")
```

- `readr::read_csv_chunked`

`readr::parse_number` is an extremely useful function to know about if you are reading data into R that you know is numerical in nature but might contain extra characters such as units.

```{r}
text_to_parse <- c(" 0.4m", "-6", "a5", "1E-2", "24%", "3e2")

readr::parse_number(text_to_parse)
```


<div class='exercise'>
#### Exercise


</div>

### [purrr](https://purrr.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/purrr.png")
```

- `purrr::map`
- `purrr::walk`
- `purrr::transpose`
- `purrr::keep`/`purrr::discard`/`purrr::pluck`


<div class='exercise'>
#### Exercise





</div>


## Extra Tidyverse

- readxl
- googlesheets4

```{r, eval = FALSE}
library(googlesheets4)

# grab the url from the browser for your sheet
url <- "https://docs.google.com/spreadsheets/d/1MbE2_XUfQ9KwfKAJhEDPb6KgOg2EaoXr5IN2F-hjBNI/edit#gid=0"

# read the sheet in
my_google_sheet <- read_sheet(url)
```

The first time running `read_sheet` you will be asked to authenticate and a web broswer will open up.

- lubridate
    - `lubridate::ymd`
- hms
- magrittr
    - `magrittr::%$%`
    - `magrittr::%T%`
- glue
    - `glue::glue`
- dtplyr
- dbplyr



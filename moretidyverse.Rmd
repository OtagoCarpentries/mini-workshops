---
title: "More Tidyverse"
description: |
  Take the time to explore the lesser known functions and packages of the Tidyverse
author:
  - name: Murray Cadzow
    url: 
    affiliation: University of Otago
    affiliation_url:
  - name: Matt Bixley
    url: 
    affiliation: NeSI
    affiliation_url:
date: "2021-07-05"
output: 
  distill::distill_article:
    toc: yes
    css: style.css
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

Time: 90 min

Description: Take the time to explore the lesser known functions and packages of the Tidyverse. Learn about how to access googlesheets, use times/dates, manipulate text, use functional programming to replace loops, and more.

Learning objectives

- What packages are in the tidyverse
- Understand functional programming







> The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures. 
> -  https://www.tidyverse.org


https://rstudio-education.github.io/tidyverse-cookbook/index.html

## Core Tidyverse

```{r, message = TRUE}
library(tidyverse)
```



### [tibble](https://tibble.tidyverse.org)

```{r, echo = FALSE}
knitr::include_graphics("images/tibble.png")
```


`tibble::tribble` is a useful function if you want to manually input a small amount of data.

```{r, echo = TRUE}
tibble::tribble( ~column1, ~column2, ~column3,
                 "a", 1, TRUE,
                 "b", 2, FALSE)
```



`tibble::glimpse` is similar to `str` but can be embedded in pipelines as it invisibly returns the original data.

```{r}
tibble::glimpse(mtcars)
```

<div class='exercise'>
#### Exercise

Use `tribble()` to manually input some data 
</div>





### [dplyr](https://dplyr.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/dplyr.png")
```
 
 `dplyr::rename` provides the renaming ability of `dplyr::select` but it doesn't subset.
 
`dplyr::transmute` is similar to `dplyr::mutate` except only columns specified are kept.

`dplyr::starts_with`/`dplyr::contains`/`dplyr::ends_with` are useful helper functions to enable easy selection of columns.

`dplyr::relocate` is a very useful function that enables you to relocate columns to specific locations. It uses a `.before` or `.after` argument to specify where you to more the column(s) to.

`dplyr::across` lets you apply a function or functions across multiple columns. This is usually used in conjunction with `dplyr::summarise` or `dplyr::mutate`.

`dplyr::c_across` lets you combine values from across multiple columns, such as performing a summarising function on select columns.

`dplyr::case_when` is useful in situations where you would have multiple ifelses.

<div class='exercise'>
#### Exercise


</div>



### [tidyr](https://tidyr.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/tidyr.png")
```

`tidyr::nest` will for per row, condense the specified columns into a list, which is stored in a single column (list column). `tidyr::unnest` will take the elements from a list column into their own columns. These functions are particularly useful in conjunction with `pivot_longer`/`pivot_wider`

`tidyr::unite`/`tidyr::separate` will either combine columns with a separator, or split to new columns based on a separator. `tidyr::separate_rows` will separate a column based on a separator but into separate rows, duplicating the related row data with it.

`tidyr::crossing` provides a mechanism to create all permutations by 'crossing' the values in two vectors. This is particularly useful when combined with `purrr` for running a function on all sub-groups within your data. 

`tidyr::drop_na` is function that provides a way to remove rows that contain missing data. If a column(s) is specified rows are only removed if the missing data is in the specific columns.

`tidyr::replace_na` is a function that lets you specify replacement values for your missing values. The values are specified using a named list, with the names corresponding to the columns your want to replace the data in.


<div class='exercise'>
#### Exercise

Create a data.frame/tibble from the starwars dataset which shows one character/film combo per row for all the films and characters.

```{r, eval = FALSE}
# starwars dataset
dplyr::starwars

```

</div>


### [stringr](https://stringr.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/stringr.png")
```

- `stringr::str_detect`
- `stringr::str_remove`
- `stringr::str_extract`

<div class='exercise'>
#### Exercise


</div>

### [readr](https://readr.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/readr.png")
```

- `readr::read_csv_chunked`

`readr::parse_number` is an extremely useful function to know about if you are reading data into R that you know is numerical in nature but might contain extra characters such as units.

```{r}
text_to_parse <- c(" 0.4m", "-6", "a5", "1E-2", "24%", "3e2")

readr::parse_number(text_to_parse)
```


<div class='exercise'>
#### Exercise


</div>

### [ggplot2](https://ggplot2.tidyverse.org)

```{r, echo = FALSE}
knitr::include_graphics("images/ggplot2.png")
```

The majority of `ggplot2` functions are specific to the type of visualisation that is being created and well covered by the cheatsheet. There is one however that can be very helpful to know about.


`ggplot2::theme_set` allows you to apply a theme to all of your ggplots. It would usually be called near the start of a script.


```{r}
# Set the theme to theme_bw for all following plots
ggplot2::theme_set(theme_bw())
```

### [forcats](https://forcats.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/forcats.png")
```



`forcats::reorder` lets you reorder your factor levels by sorting against another variable. `forcats::reorder2` is the same as `reorder` but you can use two variables. The default function for sorting is based on the median.

```{r}
df <- tibble::tribble(
  ~color,     ~a, ~b,
  "blue",      1,  2,
  "green",     6,  2,
  "purple",    3,  3,
  "red",       2,  3,
  "yellow",    5,  1
)
df$color <- factor(df$color)
fct_reorder(df$color, df$a, min)
fct_reorder2(df$color, df$a, df$b)

```

`forcats::infreq` will reorder the factor levels based on the frequency of the observations (highest first), and `forcats::fct_rev` will reverse that order (lowest first).


`forcats::relevel` lets you manually reorder the levels in your factor. This is useful for when you want to move a particular level such as `NA` to the end.

```{r}
my_fct <- factor(c("blue","green","blue", "none", "blue", "purple", "purple"))
my_fct

fct_relevel(my_fct, "none")

# send to the end
fct_relevel(my_fct, "none", after = Inf)

```






<div class='exercise'>
#### Exercise

Alter the following code that creates a bar plot to use `forcats` to re-order the bars the species of penguins are ordered by frequency, lowest on the left.

```{r, eval = FALSE}
library(tidyverse)
library(palmerpenguins)

penguins %>% 
  ggplot(aes(x = species)) + geom_bar()
```


</div>


### [purrr](https://purrr.tidyverse.org)


```{r, echo = FALSE}
knitr::include_graphics("images/purrr.png")
```

- `purrr::map`
- `purrr::walk`
- `purrr::transpose`
- `purrr::keep`/`purrr::discard`/`purrr::pluck`


<div class='exercise'>
#### Exercise





</div>


## Extra Tidyverse

- googlesheets4

```{r, eval = FALSE}
library(googlesheets4)

# grab the url from the browser for your sheet
url <- "https://docs.google.com/spreadsheets/d/1MbE2_XUfQ9KwfKAJhEDPb6KgOg2EaoXr5IN2F-hjBNI/edit#gid=0"

# read the sheet in
my_google_sheet <- read_sheet(url)
```

The first time running `read_sheet` you will be asked to authenticate and a web broswer will open up.


- readxl
- lubridate
    - `lubridate::ymd`
- hms
- magrittr
    - `magrittr::%$%`
    - `magrittr::%T%`
- glue
    - `glue::glue`
- dtplyr
- dbplyr


